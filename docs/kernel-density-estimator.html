<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 3 Kernel Density Estimator | Advanced Geospatial Data Analysis in R: Environmental Application</title>
<meta name="author" content="Marj Tonini, Haokun Liu">
<meta name="description" content="3.1 Introduction The configuration of forest fires across space and time presents a complex pattern which significantly affects the forest environment and adjacent human developments. Statistical...">
<meta name="generator" content="bookdown 0.37 with bs4_book()">
<meta property="og:title" content="Chapter 3 Kernel Density Estimator | Advanced Geospatial Data Analysis in R: Environmental Application">
<meta property="og:type" content="book">
<meta property="og:image" content="/images/UNIL_logo.png">
<meta property="og:description" content="3.1 Introduction The configuration of forest fires across space and time presents a complex pattern which significantly affects the forest environment and adjacent human developments. Statistical...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 3 Kernel Density Estimator | Advanced Geospatial Data Analysis in R: Environmental Application">
<meta name="twitter:description" content="3.1 Introduction The configuration of forest fires across space and time presents a complex pattern which significantly affects the forest environment and adjacent human developments. Statistical...">
<meta name="twitter:image" content="/images/UNIL_logo.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.6.1/transition.js"></script><script src="libs/bs3compat-0.6.1/tabs.js"></script><script src="libs/bs3compat-0.6.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Advanced Geospatial Data Analysis in R: Environmental Application</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Preface</a></li>
<li><a class="" href="introduction-to-r.html"><span class="header-section-number">1</span> Introduction to R</a></li>
<li><a class="" href="geographically-weighted-summary-statistics.html"><span class="header-section-number">2</span> Geographically Weighted Summary Statistics</a></li>
<li><a class="active" href="kernel-density-estimator.html"><span class="header-section-number">3</span> Kernel Density Estimator</a></li>
<li><a class="" href="density-based-clustering-algorithm.html"><span class="header-section-number">4</span> Density-based Clustering Algorithm</a></li>
<li><a class="" href="self-organizing-map.html"><span class="header-section-number">5</span> Self-organizing Map</a></li>
<li><a class="" href="random-forest.html"><span class="header-section-number">6</span> Random Forest</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/Unil-SGC/AGDA-Rbook">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="kernel-density-estimator" class="section level1" number="3">
<h1>
<span class="header-section-number">3</span> Kernel Density Estimator<a class="anchor" aria-label="anchor" href="#kernel-density-estimator"><i class="fas fa-link"></i></a>
</h1>
<div id="introduction-1" class="section level2" number="3.1">
<h2>
<span class="header-section-number">3.1</span> Introduction<a class="anchor" aria-label="anchor" href="#introduction-1"><i class="fas fa-link"></i></a>
</h2>
<p>The configuration of forest fires across space and time presents a complex pattern which significantly affects the forest environment and adjacent human developments.
Statistical techniques designed for spatio-temporal random points can be utilized to identify a structure, recognize hot-spots and vulnerable areas, and address policy makers to prevention and forecasting measures.</p>
<p>In this practical computer lab we consider the same case study as in the “Geographically Weighted Summary Statistics” lab.
The main objective is to reveal if space and time act independently or whether neighboring events are also closer in time, interacting to generate spatio-temporal clusters.
The attribute that we will consider to achieve this goal is the starting date of fires events.
To account for the different geographical distribution of fires in Portugal, evets occurred in the Norther and Southern area will be modeled separately.</p>
<p>For more details about the input dataset, please refer to the GWSS lab documentation.</p>
</div>
<div id="method" class="section level2" number="3.2">
<h2>
<span class="header-section-number">3.2</span> Method<a class="anchor" aria-label="anchor" href="#method"><i class="fas fa-link"></i></a>
</h2>
<p>To detect spatio-temporal clusters of forest fires, we will use the following statistical methods:</p>
<ol style="list-style-type: decimal">
<li><p>The <strong>Ripley’s K- function</strong>, to test the space–time interaction and the spatial attraction/in dependency between fires of different size.</p></li>
<li><p>The <strong>kernel density estimator</strong>, allowing elaborating smoothed density surfaces representing fires over-densities.</p></li>
</ol>
<p>We provide below a short description for both these methods.
More details can be found in <span class="citation">Tonini et al.<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="references.html#ref-tonini_evolution_2017"&gt;&lt;span&gt;“Evolution of Forest Fires in Portugal”&lt;/span&gt;&lt;/a&gt;.&lt;/p&gt;'><sup>5</sup></a></span></p>
<div id="ripleys-k-function" class="section level3" number="3.2.1">
<h3>
<span class="header-section-number">3.2.1</span> Ripley’s K-function<a class="anchor" aria-label="anchor" href="#ripleys-k-function"><i class="fas fa-link"></i></a>
</h3>
<p>The Ripley’s K-function allows inferring about the spatial randomness of mapped punctual events.
It is largely applied in environmental studies to analyse the pattern distribution of a spatial point process.
The original spatial univariate K-function <span class="math inline">\(K(s)\)</span> is defined as the ratio between the expected number <span class="math inline">\(E\)</span> of point events falling at a certain distance <span class="math inline">\(r\)</span> from an arbitrary event and the intensity <span class="math inline">\(\lambda\)</span> of the spatial point process, this last corresponding to the average number of points per unit area.</p>
<p>Under complete spatial randomness, which assumes the independence among the events, <span class="math inline">\(K(s)\)</span> is equal to the area of the circle around the target event for each distance’s value.
It follows that events are spatially clustered within the range of distances at which <span class="math inline">\(K(s)\)</span> assumes vales higher than this area, while they are spatially dispersed for lower values.
The temporal K-function <span class="math inline">\(K(t)\)</span> is defined in the same way as for the spatial case, with the time-based intensity and the time length replacing the spatial parameters.</p>
<p>The <strong>spatio-temporal K-function,</strong> <span class="math inline">\(K(s,t)\)</span> can be considered as a bivariate function where space and time represent the two variables of the equation.
It is defined as the number of further events occurring within a distance <span class="math inline">\(r\)</span> and time <span class="math inline">\(t\)</span> from an arbitrary event.</p>
<div id="spatio-temporal-interaction" class="section level4" number="3.2.1.1">
<h4>
<span class="header-section-number">3.2.1.1</span> Spatio-temporal interaction<a class="anchor" aria-label="anchor" href="#spatio-temporal-interaction"><i class="fas fa-link"></i></a>
</h4>
<p>If there is no space–time interaction, <span class="math inline">\(K(s,t)\)</span> is equal to the product of the purely spatial and purely temporal K-function.
Inversely, if space and time interact generating clusters, the difference between these two values is positive [<span class="math inline">\(D(s,t)=K(s,t)-K(s)*K(t)\)</span>].</p>
<p>Thus, we can use the perspective 3D-plot of the function <span class="math inline">\(D(s,t)\)</span> to obtain a first diagnostic of space–time clustering: positive values indicate an interaction between these two variables at a well-detectable spatio-temporal scale.</p>
</div>
</div>
<div id="kernel-density-estimator-1" class="section level3" number="3.2.2">
<h3>
<span class="header-section-number">3.2.2</span> Kernel density estimator<a class="anchor" aria-label="anchor" href="#kernel-density-estimator-1"><i class="fas fa-link"></i></a>
</h3>
<p>The Kernel Density Estimator (KDE) is a non-parametric descriptor tool widely applied in GIS-science to elaborate smoothed density surfaces from spatial variables.
A kernel function <span class="math inline">\(K\)</span> allows weighing up the contribution of each event, based on the relative distance of neighbouring to the target.
The parameter <span class="math inline">\(h\)</span>, called bandwidth, controls the smoothness of the estimated kernel density.
Finally, the kernel density function <span class="math inline">\(f_h(x)\)</span> is estimated by summing all the kernel functions <span class="math inline">\(K\)</span> computed at each point location <span class="math inline">\(x\)</span> and dividing the result by the total number of events (<span class="math inline">\(n\)</span>): <span class="math display">\[f_h(x) = \frac{1}{nh}\sum_{i=j}^{n}K(\frac{x-x_i}{h})\]</span></p>
<p>The time extension of the kernel density estimator (<span class="citation">Tomoki Nakaya and Keiji Yano<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="references.html#ref-nakaya_visualising_2010"&gt;&lt;span&gt;“Visualising Crime Clusters in a Space-Time Cube: An Exploratory Data-Analysis Approach Using Space-Time Kernel Density Estimation and Scan Statistics,”&lt;/span&gt; &lt;em&gt;Transactions in &lt;span&gt;GIS&lt;/span&gt;&lt;/em&gt; 14, no. 3 (2010): 223–39, &lt;span&gt;https://doi.org/10.1111/j.1467-9671.2010.01194.x&lt;/span&gt;&lt;/a&gt;.&lt;/p&gt;'><sup>6</sup></a></span>) allows to compute the <strong>three-dimensional kernel density estimator</strong> which includes the spatio-temporal dimensions.</p>
<p>In the present case study we apply a quadratic weighting kernel function, which is an approximation to the Gaussian kernel.
Regarding the bandwidth’s value, we prose to consider the results of the spatio-temporal K-function as an indicator.
Indeed, the distance values showing a maximum cluster behavior over the displayed perspective <span class="math inline">\(D(s,t)\)</span> plot can be attributed to the <span class="math inline">\(h\)</span>-value, minimizing the problem of under- or over-smoothing due to an arbitrary choice of the bandwidth.</p>
</div>
</div>
<div id="load-the-libraries-1" class="section level2" number="3.3">
<h2>
<span class="header-section-number">3.3</span> Load the libraries<a class="anchor" aria-label="anchor" href="#load-the-libraries-1"><i class="fas fa-link"></i></a>
</h2>
<p>Fist you have to load the following libraries:</p>
<ul>
<li>
<strong>splancs</strong>: for display and analysis of spatial point pattern data.</li>
<li>
<strong>sf</strong>: Support for simple features, a standardized way to encode spatial vector data</li>
<li>
<strong>ggplot2</strong>: A system for ‘declaratively’ creating graphics</li>
<li>
<strong>sp</strong>: Classes and methods for spatial data</li>
<li>
<strong>spatstat</strong>: comprehensive open-source toolbox for analyzing Spatial Point Patterns</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://www.maths.lancs.ac.uk/~rowlings/Splancs/">splancs</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://spatstat.org/">spatstat</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/edzer/sp/">sp</a></span><span class="op">)</span></span>
<span></span>
<span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/zpackages.html">.packages</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "ggplot2"          "sf"              </span></span>
<span><span class="co">#&gt;  [3] "spatstat"         "spatstat.linnet" </span></span>
<span><span class="co">#&gt;  [5] "spatstat.model"   "rpart"           </span></span>
<span><span class="co">#&gt;  [7] "spatstat.explore" "nlme"            </span></span>
<span><span class="co">#&gt;  [9] "spatstat.random"  "spatstat.geom"   </span></span>
<span><span class="co">#&gt; [11] "spatstat.data"    "splancs"         </span></span>
<span><span class="co">#&gt; [13] "sp"               "stats"           </span></span>
<span><span class="co">#&gt; [15] "graphics"         "grDevices"       </span></span>
<span><span class="co">#&gt; [17] "utils"            "datasets"        </span></span>
<span><span class="co">#&gt; [19] "methods"          "base"</span></span></code></pre></div>
</div>
<div id="import-the-portuguese-forest-fire-dataset-1" class="section level2" number="3.4">
<h2>
<span class="header-section-number">3.4</span> Import the Portuguese forest fire dataset<a class="anchor" aria-label="anchor" href="#import-the-portuguese-forest-fire-dataset-1"><i class="fas fa-link"></i></a>
</h2>
<p>In this section you will load the geodata representing the dataset of the Forest Fires (<strong>FF</strong>) occurred in the continental Portuguese area in the period 1990-2013.
You will also load the boundaries of the study area.
You will start by exploring the datasets using mainly visual tools (plotting and histogram).</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Import Portugal boundary </span></span>
<span><span class="va">Portugal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span><span class="st">"data/Lab02/Portugal.shp"</span><span class="op">)</span> <span class="co"># entire area</span></span>
<span></span>
<span><span class="va">PortN</span><span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span><span class="st">"data/Lab02/Porto_North.shp"</span><span class="op">)</span> <span class="co"># northern area </span></span>
<span><span class="va">PortS</span><span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span><span class="st">"data/Lab02/Porto_South.shp"</span><span class="op">)</span> <span class="co"># southern</span></span>
<span></span>
<span><span class="co"># Import the forest fires dataset</span></span>
<span></span>
<span><span class="va">FF</span><span class="op">&lt;-</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span><span class="st">"data/Lab02/ForestFires.shp"</span><span class="op">)</span> <span class="co"># entire area</span></span>
<span><span class="va">FFN</span><span class="op">&lt;-</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span><span class="st">"data/Lab02/FF_North.shp"</span><span class="op">)</span> <span class="co">#entire area</span></span>
<span><span class="va">FFS</span><span class="op">&lt;-</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span><span class="st">"data/Lab02/FF_South.shp"</span><span class="op">)</span> <span class="co"># Northern area</span></span>
<span></span>
<span><span class="co"># Import the shapefile of the Tagus river</span></span>
<span><span class="va">river</span><span class="op">&lt;-</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span><span class="st">"data/Lab02/Rio_Tajo.shp"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">FF</span><span class="op">$</span><span class="va">Area_ha</span><span class="op">)</span><span class="co"># summary statistics</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">FF</span><span class="op">$</span><span class="va">Area_ha</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="03-KDE_files/figure-html/import-data-1.png" width="672"></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">FF</span><span class="op">$</span><span class="va">Area_ha</span><span class="op">)</span><span class="op">)</span> <span class="co"># see the lab GWSS for more details </span></span></code></pre></div>
<div class="inline-figure"><img src="03-KDE_files/figure-html/import-data-2.png" width="672"></div>
<p>For a better understanding of the phenomenon, we can group the events according to the size of the burnt area and to their incidence in the northern and in the southern part of continental Portugal.</p>
<div id="ff-subsets-based-on-the-burned-areas-size" class="section level3" number="3.4.1">
<h3>
<span class="header-section-number">3.4.1</span> FF-subsets based on the burned areas’ size<a class="anchor" aria-label="anchor" href="#ff-subsets-based-on-the-burned-areas-size"><i class="fas fa-link"></i></a>
</h3>
<p>Remember that fires of different size can have been induced by different drivers.
Thus, in the following, we will investigate all the global cluster behavior of forest fires in Portugal considering the three subset separately.
As you have seen in the lab GWSS, based on the frequency distribution of the burned areas, the following three classes can be defined:</p>
<p>* Small fires: less than 15 ha</p>
<p>* Medium fires: between 15 ha and 100 ha</p>
<p>* Large fires: bigger than 100 ha</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">SF</span><span class="op">=</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">FF</span>, <span class="va">Area_ha</span> <span class="op">&lt;=</span><span class="fl">15</span><span class="op">)</span><span class="op">)</span> <span class="co">#create a sub-set including only small fires. </span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">SF</span><span class="op">)</span></span>
<span><span class="co">#&gt;       Year         Area_ha             X         </span></span>
<span><span class="co">#&gt;  Min.   :1990   Min.   : 5.000   Min.   : 82761  </span></span>
<span><span class="co">#&gt;  1st Qu.:1997   1st Qu.: 6.624   1st Qu.:182973  </span></span>
<span><span class="co">#&gt;  Median :2001   Median : 8.569   Median :213159  </span></span>
<span><span class="co">#&gt;  Mean   :2002   Mean   : 9.041   Mean   :219789  </span></span>
<span><span class="co">#&gt;  3rd Qu.:2008   3rd Qu.:11.219   3rd Qu.:259054  </span></span>
<span><span class="co">#&gt;  Max.   :2013   Max.   :15.000   Max.   :361492  </span></span>
<span><span class="co">#&gt;        Y                   geometry    </span></span>
<span><span class="co">#&gt;  Min.   :  7772   POINT        :10902  </span></span>
<span><span class="co">#&gt;  1st Qu.:403849   epsg:NA      :    0  </span></span>
<span><span class="co">#&gt;  Median :472892   +proj=tmer...:    0  </span></span>
<span><span class="co">#&gt;  Mean   :440692                        </span></span>
<span><span class="co">#&gt;  3rd Qu.:518384                        </span></span>
<span><span class="co">#&gt;  Max.   :573193</span></span>
<span></span>
<span><span class="co"># This is to save the plot </span></span>
<span><span class="va">pSF</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span> <span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">Portugal</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">SF</span>, size<span class="op">=</span><span class="fl">0.5</span>, col<span class="op">=</span><span class="st">"yellow"</span><span class="op">)</span><span class="op">+</span></span>
<span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Small fires"</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">coord_sf</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">MF</span><span class="op">=</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">FF</span>, <span class="va">Area_ha</span> <span class="op">&gt;</span><span class="fl">15</span> <span class="op">&amp;</span> <span class="va">Area_ha</span> <span class="op">&lt;=</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="co">#create a sub-set including only medium fires. </span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">MF</span><span class="op">)</span></span>
<span><span class="co">#&gt;       Year         Area_ha            X         </span></span>
<span><span class="co">#&gt;  Min.   :1990   Min.   :15.00   Min.   : 82127  </span></span>
<span><span class="co">#&gt;  1st Qu.:1997   1st Qu.:21.18   1st Qu.:186031  </span></span>
<span><span class="co">#&gt;  Median :2001   Median :30.89   Median :219459  </span></span>
<span><span class="co">#&gt;  Mean   :2002   Mean   :38.55   Mean   :223915  </span></span>
<span><span class="co">#&gt;  3rd Qu.:2007   3rd Qu.:51.06   3rd Qu.:264349  </span></span>
<span><span class="co">#&gt;  Max.   :2013   Max.   :99.98   Max.   :359535  </span></span>
<span><span class="co">#&gt;        Y                   geometry    </span></span>
<span><span class="co">#&gt;  Min.   :  7084   POINT        :12070  </span></span>
<span><span class="co">#&gt;  1st Qu.:403864   epsg:NA      :    0  </span></span>
<span><span class="co">#&gt;  Median :468503   +proj=tmer...:    0  </span></span>
<span><span class="co">#&gt;  Mean   :439442                        </span></span>
<span><span class="co">#&gt;  3rd Qu.:518248                        </span></span>
<span><span class="co">#&gt;  Max.   :572488</span></span>
<span></span>
<span><span class="co"># This is to save the plot </span></span>
<span><span class="va">pMF</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span> <span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">Portugal</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">MF</span>, size<span class="op">=</span><span class="fl">0.5</span>, col<span class="op">=</span><span class="st">"orange"</span><span class="op">)</span><span class="op">+</span></span>
<span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Midium fires"</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">coord_sf</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">LF</span><span class="op">=</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">FF</span>, <span class="va">Area_ha</span> <span class="op">&gt;</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="co">#create a sub-set including only large fires.</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span> <span class="op">(</span><span class="va">LF</span><span class="op">)</span></span>
<span><span class="co">#&gt;       Year         Area_ha              X         </span></span>
<span><span class="co">#&gt;  Min.   :1990   Min.   :  100.0   Min.   : 83472  </span></span>
<span><span class="co">#&gt;  1st Qu.:1996   1st Qu.:  139.6   1st Qu.:193831  </span></span>
<span><span class="co">#&gt;  Median :2002   Median :  220.7   Median :228709  </span></span>
<span><span class="co">#&gt;  Mean   :2001   Mean   :  548.3   Mean   :229278  </span></span>
<span><span class="co">#&gt;  3rd Qu.:2006   3rd Qu.:  447.9   3rd Qu.:266146  </span></span>
<span><span class="co">#&gt;  Max.   :2013   Max.   :66070.6   Max.   :357933  </span></span>
<span><span class="co">#&gt;        Y                   geometry   </span></span>
<span><span class="co">#&gt;  Min.   :  8840   POINT        :4301  </span></span>
<span><span class="co">#&gt;  1st Qu.:383164   epsg:NA      :   0  </span></span>
<span><span class="co">#&gt;  Median :445272   +proj=tmer...:   0  </span></span>
<span><span class="co">#&gt;  Mean   :423441                       </span></span>
<span><span class="co">#&gt;  3rd Qu.:500321                       </span></span>
<span><span class="co">#&gt;  Max.   :571984</span></span>
<span></span>
<span><span class="co"># This is to save the plot </span></span>
<span><span class="va">pLF</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span> <span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">Portugal</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">LF</span>, size<span class="op">=</span><span class="fl">0.5</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span><span class="op">+</span></span>
<span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Large fires"</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">coord_sf</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Arrange the three spatial maps side by side</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">'patchwork'</span>, repos <span class="op">=</span> <span class="st">"http://cran.us.r-project.org"</span><span class="op">)</span> </span>
<span><span class="co">#&gt; package 'patchwork' successfully unpacked and MD5 sums checked</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; The downloaded binary packages are in</span></span>
<span><span class="co">#&gt;  C:\Users\mtonini1\AppData\Local\Temp\Rtmpc5rdjj\downloaded_packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com">patchwork</a></span><span class="op">)</span> <span class="co"># Allow to  combine separate ggplots into the same graphic</span></span>
<span></span>
<span><span class="va">pSF</span><span class="op">+</span><span class="va">pMF</span><span class="op">+</span><span class="va">pLF</span></span></code></pre></div>
<div class="inline-figure"><img src="03-KDE_files/figure-html/plot-FFsubsets-1.png" width="672"></div>
</div>
<div id="ff-subsets-based-on-their-geographical-distribution" class="section level3" number="3.4.2">
<h3>
<span class="header-section-number">3.4.2</span> FF-subsets based on their geographical distribution<a class="anchor" aria-label="anchor" href="#ff-subsets-based-on-their-geographical-distribution"><i class="fas fa-link"></i></a>
</h3>
<p>In continental Portugal, the <strong>northern half</strong> of the country (above the Tagus River) is characterized by the predominance of forest and semi-natural areas, and by the development of the main cities with their sub-urban ares intermingled with wild land, which the Northern area highly prone to forest fires.
On the other hand, the <strong>southern half</strong> of the country is dominated by agricultural areas with mixed and broad-leaved forest concentrated near the south-west coast, which makes this are less affected by forest fires.
For this reason we will consider these two areas separately.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Plot the map with all the objects</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span> <span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">Portugal</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">river</span>, col<span class="op">=</span><span class="st">"blue"</span>, size<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">FFN</span>, size<span class="op">=</span><span class="fl">0.3</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">FFS</span>, size<span class="op">=</span><span class="fl">0.3</span>, col<span class="op">=</span><span class="st">"orange"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Forest foirest in the northern and souther area"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.title<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">coord_sf</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="03-KDE_files/figure-html/import-NS-FF-1.png" width="672"></div>
</div>
</div>
<div id="the-space-time-k-function" class="section level2" number="3.5">
<h2>
<span class="header-section-number">3.5</span> The space-time K-function<a class="anchor" aria-label="anchor" href="#the-space-time-k-function"><i class="fas fa-link"></i></a>
</h2>
<div id="extract-time-and-pts-object" class="section level3" number="3.5.1">
<h3>
<span class="header-section-number">3.5.1</span> Extract Time and PTS object<a class="anchor" aria-label="anchor" href="#extract-time-and-pts-object"><i class="fas fa-link"></i></a>
</h3>
<p>The function <strong>stkhat,</strong> included in the library <em>spancs</em>, allows to compute the space-time K-function.
As you can see from the R Documentation (command: <em>help(stkhat)</em>), same data manipulations are necessary to transform the input data in a compatible data frame format.</p>
<p>Namely the user needs to specify:</p>
<ul>
<li><p><em>pts</em>: the input forest fires dataset, with the coordinates to geolocalize each event.</p></li>
<li><p><em>times</em>: a vector of times, defined by the starting date of ignition.</p></li>
<li><p><em>poly</em>: a polygon of class matrix enclosing the input dataset (<em>pts)</em></p></li>
<li><p><em>s</em> and <em>tm</em>: a vector of spatial (<em>s</em>) and a vector of temporal (<em>tm</em>) distances for the analysis.</p></li>
</ul>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Extract "pts" (divided by 1000 to compute in Km)</span></span>
<span><span class="va">FFN_pts</span><span class="op">&lt;-</span><span class="fu"><a href="https://rsbivand.github.io/splancs/reference/as.points.html">as.points</a></span><span class="op">(</span><span class="va">FFN</span><span class="op">$</span><span class="va">X</span><span class="op">/</span><span class="fl">1000</span>,<span class="va">FFN</span><span class="op">$</span><span class="va">Y</span><span class="op">/</span><span class="fl">1000</span><span class="op">)</span> </span>
<span><span class="va">FFN_times</span><span class="op">&lt;-</span><span class="va">FFN</span><span class="op">$</span><span class="va">Year</span> <span class="co"># extract "times"</span></span>
<span></span>
<span><span class="co"># Extract the coordinates (in Km):</span></span>
<span><span class="va">PTN_xy</span><span class="op">&lt;-</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html">st_coordinates</a></span><span class="op">(</span><span class="va">PortN</span><span class="op">$</span><span class="va">geometry</span><span class="op">/</span><span class="fl">1000</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># Define the matrix with the set of bounding points ("poly") enclosing the input dataset:</span></span>
<span><span class="va">FFN_poly</span><span class="op">&lt;-</span><span class="va">PTN_xy</span><span class="op">[</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">4</span><span class="op">)</span><span class="op">]</span> </span></code></pre></div>
</div>
<div id="compute-the-space-time-k-function" class="section level3" number="3.5.2">
<h3>
<span class="header-section-number">3.5.2</span> Compute the space-time K-function<a class="anchor" aria-label="anchor" href="#compute-the-space-time-k-function"><i class="fas fa-link"></i></a>
</h3>
<p>Compute the space-time K-function for forest fires in the northern area.
Since the computation can take a long time (about 20 mints), we propose you to load directly the output R object provided (<em>STK_North_10y</em>).
The general code is also provided, but preceded by the hashtag, so it is not treated as a command: you have to remove # if you wish to evaluate the code.</p>
<ul>
<li><p>We consider here a <em>subset</em> of forest fires event occurred in the period 2001-2010.</p></li>
<li><p>The parameters <em>s</em> and <em>t</em> are defined here as follows: (<em>s</em>) each kilometer distance up to ten kilometers; (<em>tm</em>) each year up to five years.</p></li>
</ul>
<p><strong>NB</strong>: If you wish to run the code, remove # to make it work</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Open stkhat documentation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/help.html">help</a></span><span class="op">(</span><span class="va">stkhat</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org">readr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">STK_North_10y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"data/Lab02/STK_North_10y.RData"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">STK_North_10y</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 5</span></span>
<span><span class="co">#&gt;  $ s  : num [1:11] 0 1 2 3 4 5 6 7 8 9 ...</span></span>
<span><span class="co">#&gt;  $ t  : num [1:6] 0 1 2 3 4 5</span></span>
<span><span class="co">#&gt;  $ ks : num [1:11] 1.61e-04 9.03 2.98e+01 6.18e+01 1.05e+02 ...</span></span>
<span><span class="co">#&gt;  $ kt : num [1:6] 0.814 2.29 3.596 4.827 6.085 ...</span></span>
<span><span class="co">#&gt;  $ kst: num [1:11, 1:6] 1.45e-03 1.06e+01 3.75e+01 7.47e+01 1.22e+02 ...</span></span></code></pre></div>
</div>
<div id="assess-the-space-time-clustering-behavior" class="section level3" number="3.5.3">
<h3>
<span class="header-section-number">3.5.3</span> Assess the space-time clustering behavior<a class="anchor" aria-label="anchor" href="#assess-the-space-time-clustering-behavior"><i class="fas fa-link"></i></a>
</h3>
<p>In the following section you will explore and plot the values of the three components produced as outputs of the function <em>stkhat</em>: the spatial K-function (ks), the temporal K-function (kt); the space-time K-function (kst).</p>
<p>Finally you will plot the perspective 3D-plot of <span class="math inline">\(D(s,t)\)</span> to evaluate the space–time clustering behavior of forest fires in the present case study.
The multifaceted shape of this function, along the spatial and the temporal dimension, can help to identify peaks of clustering.
Finally, the corresponding values can be attributed to the bandwidth of the kernel density estimators allowing to elaborate smoothed density maps in the last step of this lab.</p>
<div id="plot-the-stkhat-outputs" class="section level4" number="3.5.3.1">
<h4>
<span class="header-section-number">3.5.3.1</span> Plot the <em>stkhat</em> outputs<a class="anchor" aria-label="anchor" href="#plot-the-stkhat-outputs"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li><strong>Plot of the purely spatial and the purely temporal K function.</strong></li>
</ul>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Plot of the purely spatial K function</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">STK_North_10y</span><span class="op">$</span><span class="va">s</span>, <span class="va">STK_North_10y</span><span class="op">$</span><span class="va">ks</span>, type<span class="op">=</span><span class="st">"l"</span>, xlab<span class="op">=</span><span class="st">"distance"</span>, ylab<span class="op">=</span><span class="st">"Estimated Ks"</span>, main<span class="op">=</span><span class="st">"Spatial K function"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">STK_North_10y</span><span class="op">$</span><span class="va">s</span>, <span class="va">pi</span><span class="op">*</span><span class="va">STK_North_10y</span><span class="op">$</span><span class="va">s</span><span class="op">^</span><span class="fl">2</span>, type<span class="op">=</span><span class="st">"l"</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="03-KDE_files/figure-html/plot-stk-1.png" width="672"></div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Plot of the purely temporal K-function</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">STK_North_10y</span><span class="op">$</span><span class="va">t</span>, <span class="va">STK_North_10y</span><span class="op">$</span><span class="va">kt</span>, type<span class="op">=</span><span class="st">"l"</span>, xlab<span class="op">=</span><span class="st">"time"</span>, ylab<span class="op">=</span><span class="st">"Estimated Kt"</span>, main<span class="op">=</span><span class="st">"Temporal K function"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">STK_North_10y</span><span class="op">$</span><span class="va">t</span>, <span class="fl">2</span><span class="op">*</span><span class="va">STK_North_10y</span><span class="op">$</span><span class="va">t</span>, type<span class="op">=</span><span class="st">"l"</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="03-KDE_files/figure-html/plot-stk-2.png" width="672"></div>
<ul>
<li><strong>Plot the space-time D-plot</strong></li>
</ul>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Define the function: D(s,t)=K(s,t)-[K(s)*K(t)]</span></span>
<span></span>
<span><span class="va">Dplot</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">stkhat</span>, <span class="va">Dzero</span> <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">main</span><span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>  <span class="op">{</span></span>
<span></span>
<span>  <span class="va">oprod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/outer.html">outer</a></span><span class="op">(</span><span class="va">stkhat</span><span class="op">$</span><span class="va">ks</span>, <span class="va">stkhat</span><span class="op">$</span><span class="va">kt</span><span class="op">)</span></span>
<span>    <span class="va">st.D</span> <span class="op">&lt;-</span> <span class="va">stkhat</span><span class="op">$</span><span class="va">kst</span> <span class="op">-</span> <span class="va">oprod</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/graphics/persp.html">persp</a></span><span class="op">(</span><span class="va">stkhat</span><span class="op">$</span><span class="va">s</span>, <span class="va">stkhat</span><span class="op">$</span><span class="va">t</span>, <span class="va">st.D</span>, xlab <span class="op">=</span> <span class="st">"Distance (Km)"</span>, ylab <span class="op">=</span> <span class="st">"Time (years)"</span>,</span>
<span>            zlab <span class="op">=</span> <span class="st">"D(s,t)"</span>, expand <span class="op">=</span> <span class="fl">0.5</span>, ticktype <span class="op">=</span> <span class="st">"detailed"</span>,</span>
<span>            theta <span class="op">=</span> <span class="op">-</span><span class="fl">45</span>, shade <span class="op">=</span> <span class="fl">0.75</span>, cex <span class="op">=</span> <span class="fl">0.7</span>, ltheta<span class="op">=</span><span class="fl">120</span>, col<span class="op">=</span><span class="st">"cyan1"</span>, font.lab<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span>           <span class="op">}</span></span>
<span></span>
<span><span class="fu">Dplot</span><span class="op">(</span><span class="va">STK_North_10y</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html">title</a></span><span class="op">(</span><span class="st">"Dplot Nothern Fires"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="03-KDE_files/figure-html/Dplot-1.png" width="672"></div>
</div>
<div id="run-the-space-time-kernel-density-estimator" class="section level4" number="3.5.3.2">
<h4>
<span class="header-section-number">3.5.3.2</span> Run the space-time kernel density estimator<a class="anchor" aria-label="anchor" href="#run-the-space-time-kernel-density-estimator"><i class="fas fa-link"></i></a>
</h4>
<p>The multifaceted shape the D-Plot identify peaks of clustering a time value of 3 year.
In spece, events are clustered and every distance, so in this case we use the maximum values (10 km).
these two values are attributed to the bandwidth of the kernel density estimators allowing to elaborate smoothed density maps.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Open the help to analyse the parameter of this kernel function: </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/help.html">help</a></span><span class="op">(</span><span class="va">kernel3d</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run the function</span></span>
<span><span class="va">KDE_FFN</span><span class="op">&lt;-</span><span class="fu"><a href="https://rsbivand.github.io/splancs/reference/kernel3d.html">kernel3d</a></span><span class="op">(</span><span class="va">FFN_pts</span>, <span class="va">FFN_times</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">80</span>, <span class="fl">362</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">180</span>, <span class="fl">580</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1990</span>,<span class="fl">2013</span>,<span class="fl">1</span><span class="op">)</span>, <span class="fl">10</span>, <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">KDE_FFN</span><span class="op">$</span><span class="va">v</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">KDE_FFN</span><span class="op">$</span><span class="va">v</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="03-KDE_files/figure-html/hist-KDE-1.png" width="672"></div>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">KDE_FFN</span><span class="op">$</span><span class="va">v</span><span class="op">[</span><span class="va">KDE_FFN</span><span class="op">$</span><span class="va">v</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">]</span><span class="op">)</span> <span class="co">#check the lower non-zero value </span></span>
<span><span class="co">#&gt; [1] 2.893333e-12</span></span>
<span></span>
<span><span class="co"># Create quantile clssification </span></span>
<span><span class="va">Q</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">KDE_FFN</span><span class="op">$</span><span class="va">v</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">1</span>,<span class="fl">0.05</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Q</span></span>
<span><span class="co">#&gt;          50%          55%          60%          65% </span></span>
<span><span class="co">#&gt; 0.0002194741 0.0097073381 0.0263666531 0.0478856382 </span></span>
<span><span class="co">#&gt;          70%          75%          80%          85% </span></span>
<span><span class="co">#&gt; 0.0748979448 0.1093260662 0.1560709189 0.2210177893 </span></span>
<span><span class="co">#&gt;          90%          95%         100% </span></span>
<span><span class="co">#&gt; 0.3232627322 0.5162620818 2.1627084390</span></span>
<span></span>
<span><span class="co"># Create a blue/red palette</span></span>
<span><span class="va">pal</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html">colorRampPalette</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"grey"</span>,<span class="st">"blue"</span>,<span class="st">"green"</span>, <span class="st">"yellow"</span>,<span class="st">"orange"</span>, <span class="st">"red"</span> <span class="op">)</span><span class="op">)</span></span>
<span><span class="va">colsR</span><span class="op">&lt;-</span><span class="fu">pal</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">Q</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display classes</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/pie.html">pie</a></span><span class="op">(</span><span class="va">Q</span>, clockwise<span class="op">=</span><span class="cn">TRUE</span>, labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">Q</span>, digits<span class="op">=</span><span class="fl">2</span><span class="op">)</span>, border<span class="op">=</span><span class="st">"white"</span>, col<span class="op">=</span><span class="va">colsR</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="03-KDE_files/figure-html/plot-KDE-1.png" width="672"></div>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Plot KDE maps for selected years</span></span>
<span><span class="va">oldpar</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">5</span><span class="op">)</span>, mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">24</span><span class="op">)</span><span class="op">{</span></span>
<span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/graphics/image.html">image</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">80</span>, <span class="fl">362</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">180</span>, <span class="fl">580</span>, <span class="fl">1</span><span class="op">)</span>, <span class="va">KDE_FFN</span><span class="op">$</span><span class="va">v</span><span class="op">[</span>,,<span class="va">i</span><span class="op">]</span>, asp<span class="op">=</span><span class="fl">1</span>, xlab<span class="op">=</span><span class="st">""</span>, ylab<span class="op">=</span><span class="st">""</span>, main<span class="op">=</span><span class="fl">1989</span><span class="op">+</span><span class="va">i</span>, breaks<span class="op">=</span><span class="va">Q</span>, col<span class="op">=</span><span class="va">colsR</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="inline-figure"><img src="03-KDE_files/figure-html/plot-KDE-2.png" width="672"></div>
</div>
</div>
</div>
<div id="conclusions-and-further-analyses-1" class="section level2" number="3.6">
<h2>
<span class="header-section-number">3.6</span> Conclusions and further analyses<a class="anchor" aria-label="anchor" href="#conclusions-and-further-analyses-1"><i class="fas fa-link"></i></a>
</h2>
<p>This practical computer lab allowed you to familiarize with the assement of the global cluster behavior of hazardous events, achieved by using the Ripley’s k-function.
In addition, we learned how smoothed density maps can be elaborated from punctual events, namely using the kernel density estimator.
Both spatial and the temporal dimension have been considered in this case.</p>
<p>This method allowed us to explore density distribution of forest fires events through Continental Portugal in the period 1990-2013.
In the northern half of the country, hot spots are present almost on each investigated years, with a higher concentration in the northern areas.</p>
<p>To be sure that everything is perfectly clear for you, we propose you to do this lab again, by using this time another subset chosen among the forest fires in the Southern area, the small, medium or the large forest fires dataset.</p>
<p>For whatever dataset you are going to use, try to answer to the following questions.
The reading of the paper <span class="citation">Tonini et al.<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="references.html#ref-tonini_evolution_2017"&gt;&lt;span&gt;“Evolution of Forest Fires in Portugal”&lt;/span&gt;&lt;/a&gt;.&lt;/p&gt;'><sup>7</sup></a></span>, which inspired this lab, can help you in in this task.</p>
<ol style="list-style-type: decimal">
<li><p>At which spatial and temporal distance you can observe a peak of clustering?</p></li>
<li><p>Describe which is spatio-temporal density distribution of forest fires events through the study area.</p></li>
</ol>
</div>
</div>

  <div class="chapter-nav">
<div class="prev"><a href="geographically-weighted-summary-statistics.html"><span class="header-section-number">2</span> Geographically Weighted Summary Statistics</a></div>
<div class="next"><a href="density-based-clustering-algorithm.html"><span class="header-section-number">4</span> Density-based Clustering Algorithm</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#kernel-density-estimator"><span class="header-section-number">3</span> Kernel Density Estimator</a></li>
<li><a class="nav-link" href="#introduction-1"><span class="header-section-number">3.1</span> Introduction</a></li>
<li>
<a class="nav-link" href="#method"><span class="header-section-number">3.2</span> Method</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#ripleys-k-function"><span class="header-section-number">3.2.1</span> Ripley’s K-function</a></li>
<li><a class="nav-link" href="#kernel-density-estimator-1"><span class="header-section-number">3.2.2</span> Kernel density estimator</a></li>
</ul>
</li>
<li><a class="nav-link" href="#load-the-libraries-1"><span class="header-section-number">3.3</span> Load the libraries</a></li>
<li>
<a class="nav-link" href="#import-the-portuguese-forest-fire-dataset-1"><span class="header-section-number">3.4</span> Import the Portuguese forest fire dataset</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#ff-subsets-based-on-the-burned-areas-size"><span class="header-section-number">3.4.1</span> FF-subsets based on the burned areas’ size</a></li>
<li><a class="nav-link" href="#ff-subsets-based-on-their-geographical-distribution"><span class="header-section-number">3.4.2</span> FF-subsets based on their geographical distribution</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#the-space-time-k-function"><span class="header-section-number">3.5</span> The space-time K-function</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#extract-time-and-pts-object"><span class="header-section-number">3.5.1</span> Extract Time and PTS object</a></li>
<li><a class="nav-link" href="#compute-the-space-time-k-function"><span class="header-section-number">3.5.2</span> Compute the space-time K-function</a></li>
<li><a class="nav-link" href="#assess-the-space-time-clustering-behavior"><span class="header-section-number">3.5.3</span> Assess the space-time clustering behavior</a></li>
</ul>
</li>
<li><a class="nav-link" href="#conclusions-and-further-analyses-1"><span class="header-section-number">3.6</span> Conclusions and further analyses</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/Unil-SGC/AGDA-Rbook/blob/master/03-KDE.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/Unil-SGC/AGDA-Rbook/edit/master/03-KDE.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Advanced Geospatial Data Analysis in R: Environmental Application</strong>" was written by Marj Tonini, Haokun Liu. It was last built on 2024-01-16.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
