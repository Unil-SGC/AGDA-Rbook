<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 9 5) The space-time K-function | Advanced Geospatial Data Analysis in R: Environmental Application</title>
<meta name="author" content="Marj Tonini, Haokun Liu">
<meta name="description" content="9.1 5.1) Extract Time and PTS object The function stkhat, included in the library spancs, allows to compute the space-time K-function. As you can see from the R Documentation (command:...">
<meta name="generator" content="bookdown 0.36 with bs4_book()">
<meta property="og:title" content="Chapter 9 5) The space-time K-function | Advanced Geospatial Data Analysis in R: Environmental Application">
<meta property="og:type" content="book">
<meta property="og:description" content="9.1 5.1) Extract Time and PTS object The function stkhat, included in the library spancs, allows to compute the space-time K-function. As you can see from the R Documentation (command:...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 9 5) The space-time K-function | Advanced Geospatial Data Analysis in R: Environmental Application">
<meta name="twitter:description" content="9.1 5.1) Extract Time and PTS object The function stkhat, included in the library spancs, allows to compute the space-time K-function. As you can see from the R Documentation (command:...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.5.1/transition.js"></script><script src="libs/bs3compat-0.5.1/tabs.js"></script><script src="libs/bs3compat-0.5.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Advanced Geospatial Data Analysis in R: Environmental Application</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> About</a></li>
<li><a class="" href="introduction-to-r.html"><span class="header-section-number">2</span> Introduction to R</a></li>
<li><a class="" href="geographically-weighed-summary-statistics.html"><span class="header-section-number">3</span> Geographically Weighed Summary Statistics</a></li>
<li><a class="" href="kernel-density-estimator.html"><span class="header-section-number">4</span> Kernel density estimator</a></li>
<li><a class="" href="introduction-1.html"><span class="header-section-number">5</span> 1) Introduction</a></li>
<li><a class="" href="method.html"><span class="header-section-number">6</span> 2) Method</a></li>
<li><a class="" href="load-the-libraries-1.html"><span class="header-section-number">7</span> 3) Load the libraries</a></li>
<li><a class="" href="import-the-portuguese-forest-fire-dataset-1.html"><span class="header-section-number">8</span> 4) Import the Portuguese forest fire dataset</a></li>
<li><a class="active" href="the-space-time-k-function.html"><span class="header-section-number">9</span> 5) The space-time K-function</a></li>
<li><a class="" href="conclusions-and-further-analyses-1.html"><span class="header-section-number">10</span> 6) Conclusions and further analyses</a></li>
<li><a class="" href="footnotes-and-citations.html"><span class="header-section-number">11</span> Footnotes and citations</a></li>
<li><a class="" href="blocks.html"><span class="header-section-number">12</span> Blocks</a></li>
<li><a class="" href="sharing-your-book.html"><span class="header-section-number">13</span> Sharing your book</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/rstudio/bookdown-demo">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="the-space-time-k-function" class="section level1" number="9">
<h1>
<span class="header-section-number">9</span> 5) The space-time K-function<a class="anchor" aria-label="anchor" href="#the-space-time-k-function"><i class="fas fa-link"></i></a>
</h1>
<div id="extract-time-and-pts-object" class="section level2" number="9.1">
<h2>
<span class="header-section-number">9.1</span> 5.1) Extract Time and PTS object<a class="anchor" aria-label="anchor" href="#extract-time-and-pts-object"><i class="fas fa-link"></i></a>
</h2>
<p>The function <strong>stkhat,</strong> included in the library <em>spancs</em>, allows to compute the space-time K-function.
As you can see from the R Documentation (command: <em>help(stkhat)</em>), same data manipulations are necessary to transform the input data in a compatible data frame format.</p>
<p>Namely the user needs to specify:</p>
<ul>
<li><p><em>pts</em>: the input forest fires dataset, with the coordinates to geolocalize each event.</p></li>
<li><p><em>times</em>: a vector of times, defined by the starting date of ignition.</p></li>
<li><p><em>poly</em>: a polygon of class matrix enclosing the input dataset (<em>pts)</em></p></li>
<li><p><em>s</em> and <em>tm</em>: a vector of spatial (<em>s</em>) and a vector of temporal (<em>tm</em>) distances for the analysis.</p></li>
</ul>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Extract "pts" (divided by 1000 to compute in Km)</span></span>
<span><span class="va">FFN_pts</span><span class="op">&lt;-</span><span class="fu"><a href="https://rsbivand.github.io/splancs/reference/as.points.html">as.points</a></span><span class="op">(</span><span class="va">FFN</span><span class="op">$</span><span class="va">X</span><span class="op">/</span><span class="fl">1000</span>,<span class="va">FFN</span><span class="op">$</span><span class="va">Y</span><span class="op">/</span><span class="fl">1000</span><span class="op">)</span> </span>
<span><span class="va">FFN_times</span><span class="op">&lt;-</span><span class="va">FFN</span><span class="op">$</span><span class="va">Year</span> <span class="co"># extract "times"</span></span>
<span></span>
<span><span class="co"># Extract the coordinates (in Km):</span></span>
<span><span class="va">PTN_xy</span><span class="op">&lt;-</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html">st_coordinates</a></span><span class="op">(</span><span class="va">PortN</span><span class="op">$</span><span class="va">geometry</span><span class="op">/</span><span class="fl">1000</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># Define the matrix with the set of bounding points ("poly") enclosing the input dataset:</span></span>
<span><span class="va">FFN_poly</span><span class="op">&lt;-</span><span class="va">PTN_xy</span><span class="op">[</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">4</span><span class="op">)</span><span class="op">]</span> </span></code></pre></div>
</div>
<div id="compute-the-space-time-k-function" class="section level2" number="9.2">
<h2>
<span class="header-section-number">9.2</span> 5.2) Compute the space-time K-function<a class="anchor" aria-label="anchor" href="#compute-the-space-time-k-function"><i class="fas fa-link"></i></a>
</h2>
<p>Compute the space-time K-function for forest fires in the northern area.
Since the computation can take a long time (about 20 mints), we propose you to load directly the output R object provided (<em>STK_North_10y</em>).
The general code is also provided, but preceded by the hashtag, so it is not treated as a command: you have to remove # if you wish to evaluate the code.</p>
<ul>
<li><p>We consider here a <em>subset</em> of forest fires event occurred in the period 2001-2010.</p></li>
<li><p>The parameters <em>s</em> and <em>t</em> are defined here as follows: (<em>s</em>) each kilometer distance up to ten kilometers; (<em>tm</em>) each year up to five years.</p></li>
</ul>
<p><strong>NB</strong>: If you wish to run the code, remove # to make it work</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Open stkhat documentation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/help.html">help</a></span><span class="op">(</span><span class="va">stkhat</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org">readr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">STK_North_10y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"data/Lab02/STK_North_10y.RData"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">STK_North_10y</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 5</span></span>
<span><span class="co">#&gt;  $ s  : num [1:11] 0 1 2 3 4 5 6 7 8 9 ...</span></span>
<span><span class="co">#&gt;  $ t  : num [1:6] 0 1 2 3 4 5</span></span>
<span><span class="co">#&gt;  $ ks : num [1:11] 1.61e-04 9.03 2.98e+01 6.18e+01 1.05e+02 ...</span></span>
<span><span class="co">#&gt;  $ kt : num [1:6] 0.814 2.29 3.596 4.827 6.085 ...</span></span>
<span><span class="co">#&gt;  $ kst: num [1:11, 1:6] 1.45e-03 1.06e+01 3.75e+01 7.47e+01 1.22e+02 ...</span></span></code></pre></div>
</div>
<div id="assess-the-space-time-clustering-behavior" class="section level2" number="9.3">
<h2>
<span class="header-section-number">9.3</span> 5.3) Assess the space-time clustering behavior<a class="anchor" aria-label="anchor" href="#assess-the-space-time-clustering-behavior"><i class="fas fa-link"></i></a>
</h2>
<p>In the following section you will explore and plot the values of the three components produced as outputs of the function <em>stkhat</em>: the spatial K-function (ks), the temporal K-function (kt); the space-time K-function (kst).</p>
<p>Finally you will plot the perspective 3D-plot of <span class="math inline">\(D(s,t)\)</span> to evaluate the spaceâ€“time clustering behavior of forest fires in the present case study.
The multifaceted shape of this function, along the spatial and the temporal dimension, can help to identify peaks of clustering.
Finally, the corresponding values can be attributed to the bandwidth of the kernel density estimators allowing to elaborate smoothed density maps in the last step of this lab.</p>
<div id="plot-the-stkhat-outputs" class="section level3" number="9.3.1">
<h3>
<span class="header-section-number">9.3.1</span> 5.3.1) Plot the <em>stkhat</em> outputs<a class="anchor" aria-label="anchor" href="#plot-the-stkhat-outputs"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li><strong>Plot of the purely spatial and the purely temporal K function.</strong></li>
</ul>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Plot of the purely spatial K function</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">STK_North_10y</span><span class="op">$</span><span class="va">s</span>, <span class="va">STK_North_10y</span><span class="op">$</span><span class="va">ks</span>, type<span class="op">=</span><span class="st">"l"</span>, xlab<span class="op">=</span><span class="st">"distance"</span>, ylab<span class="op">=</span><span class="st">"Estimated Ks"</span>, main<span class="op">=</span><span class="st">"Spatial K function"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">STK_North_10y</span><span class="op">$</span><span class="va">s</span>, <span class="va">pi</span><span class="op">*</span><span class="va">STK_North_10y</span><span class="op">$</span><span class="va">s</span><span class="op">^</span><span class="fl">2</span>, type<span class="op">=</span><span class="st">"l"</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="03-KDE_files/figure-html/plot-stk-1.png" width="672"></div>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Plot of the purely temporal K-function</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">STK_North_10y</span><span class="op">$</span><span class="va">t</span>, <span class="va">STK_North_10y</span><span class="op">$</span><span class="va">kt</span>, type<span class="op">=</span><span class="st">"l"</span>, xlab<span class="op">=</span><span class="st">"time"</span>, ylab<span class="op">=</span><span class="st">"Estimated Kt"</span>, main<span class="op">=</span><span class="st">"Temporal K function"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">STK_North_10y</span><span class="op">$</span><span class="va">t</span>, <span class="fl">2</span><span class="op">*</span><span class="va">STK_North_10y</span><span class="op">$</span><span class="va">t</span>, type<span class="op">=</span><span class="st">"l"</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="03-KDE_files/figure-html/plot-stk-2.png" width="672"></div>
<ul>
<li><strong>Plot the space-time D-plot</strong></li>
</ul>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Define the function: D(s,t)=K(s,t)-[K(s)*K(t)]</span></span>
<span></span>
<span><span class="va">Dplot</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">stkhat</span>, <span class="va">Dzero</span> <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">main</span><span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>  <span class="op">{</span></span>
<span></span>
<span>  <span class="va">oprod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/outer.html">outer</a></span><span class="op">(</span><span class="va">stkhat</span><span class="op">$</span><span class="va">ks</span>, <span class="va">stkhat</span><span class="op">$</span><span class="va">kt</span><span class="op">)</span></span>
<span>    <span class="va">st.D</span> <span class="op">&lt;-</span> <span class="va">stkhat</span><span class="op">$</span><span class="va">kst</span> <span class="op">-</span> <span class="va">oprod</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/graphics/persp.html">persp</a></span><span class="op">(</span><span class="va">stkhat</span><span class="op">$</span><span class="va">s</span>, <span class="va">stkhat</span><span class="op">$</span><span class="va">t</span>, <span class="va">st.D</span>, xlab <span class="op">=</span> <span class="st">"Distance (Km)"</span>, ylab <span class="op">=</span> <span class="st">"Time (years)"</span>,</span>
<span>            zlab <span class="op">=</span> <span class="st">"D(s,t)"</span>, expand <span class="op">=</span> <span class="fl">0.5</span>, ticktype <span class="op">=</span> <span class="st">"detailed"</span>,</span>
<span>            theta <span class="op">=</span> <span class="op">-</span><span class="fl">45</span>, shade <span class="op">=</span> <span class="fl">0.75</span>, cex <span class="op">=</span> <span class="fl">0.7</span>, ltheta<span class="op">=</span><span class="fl">120</span>, col<span class="op">=</span><span class="st">"cyan1"</span>, font.lab<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span>           <span class="op">}</span></span>
<span></span>
<span><span class="fu">Dplot</span><span class="op">(</span><span class="va">STK_North_10y</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html">title</a></span><span class="op">(</span><span class="st">"Dplot Nothern Fires"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="03-KDE_files/figure-html/Dplot-1.png" width="672"></div>
</div>
<div id="run-the-space-time-kernel-density-estimator" class="section level3" number="9.3.2">
<h3>
<span class="header-section-number">9.3.2</span> 5.3.2) Run the space-time kernel density estimator<a class="anchor" aria-label="anchor" href="#run-the-space-time-kernel-density-estimator"><i class="fas fa-link"></i></a>
</h3>
<p>The multifaceted shape the D-Plot identify peaks of clustering a time value of 3 year.
In spece, events are clustered and every distance, so in this case we use the maximum values (10 km).
these two values are attributed to the bandwidth of the kernel density estimators allowing to elaborate smoothed density maps.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Open the help to analyse the parameter of this kernel function: </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/help.html">help</a></span><span class="op">(</span><span class="va">kernel3d</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run the function</span></span>
<span><span class="va">KDE_FFN</span><span class="op">&lt;-</span><span class="fu"><a href="https://rsbivand.github.io/splancs/reference/kernel3d.html">kernel3d</a></span><span class="op">(</span><span class="va">FFN_pts</span>, <span class="va">FFN_times</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">80</span>, <span class="fl">362</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">180</span>, <span class="fl">580</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1990</span>,<span class="fl">2013</span>,<span class="fl">1</span><span class="op">)</span>, <span class="fl">10</span>, <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">KDE_FFN</span><span class="op">$</span><span class="va">v</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">KDE_FFN</span><span class="op">$</span><span class="va">v</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="03-KDE_files/figure-html/hist-KDE-1.png" width="672"></div>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">KDE_FFN</span><span class="op">$</span><span class="va">v</span><span class="op">[</span><span class="va">KDE_FFN</span><span class="op">$</span><span class="va">v</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">]</span><span class="op">)</span> <span class="co">#check the lower non-zero value </span></span>
<span><span class="co">#&gt; [1] 2.893333e-12</span></span>
<span></span>
<span><span class="co"># Create quantile clssification </span></span>
<span><span class="va">Q</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">KDE_FFN</span><span class="op">$</span><span class="va">v</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">1</span>,<span class="fl">0.05</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Q</span></span>
<span><span class="co">#&gt;          50%          55%          60%          65% </span></span>
<span><span class="co">#&gt; 0.0002194741 0.0097073381 0.0263666531 0.0478856382 </span></span>
<span><span class="co">#&gt;          70%          75%          80%          85% </span></span>
<span><span class="co">#&gt; 0.0748979448 0.1093260662 0.1560709189 0.2210177893 </span></span>
<span><span class="co">#&gt;          90%          95%         100% </span></span>
<span><span class="co">#&gt; 0.3232627322 0.5162620818 2.1627084390</span></span>
<span></span>
<span><span class="co"># Create a blue/red palette</span></span>
<span><span class="va">pal</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html">colorRampPalette</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"grey"</span>,<span class="st">"blue"</span>,<span class="st">"green"</span>, <span class="st">"yellow"</span>,<span class="st">"orange"</span>, <span class="st">"red"</span> <span class="op">)</span><span class="op">)</span></span>
<span><span class="va">colsR</span><span class="op">&lt;-</span><span class="fu">pal</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">Q</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display classes</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/pie.html">pie</a></span><span class="op">(</span><span class="va">Q</span>, clockwise<span class="op">=</span><span class="cn">TRUE</span>, labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">Q</span>, digits<span class="op">=</span><span class="fl">2</span><span class="op">)</span>, border<span class="op">=</span><span class="st">"white"</span>, col<span class="op">=</span><span class="va">colsR</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="03-KDE_files/figure-html/plot-KDE-1.png" width="672"></div>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Plot KDE maps for selected years</span></span>
<span><span class="va">oldpar</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">5</span><span class="op">)</span>, mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">24</span><span class="op">)</span><span class="op">{</span></span>
<span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/graphics/image.html">image</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">80</span>, <span class="fl">362</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">180</span>, <span class="fl">580</span>, <span class="fl">1</span><span class="op">)</span>, <span class="va">KDE_FFN</span><span class="op">$</span><span class="va">v</span><span class="op">[</span>,,<span class="va">i</span><span class="op">]</span>, asp<span class="op">=</span><span class="fl">1</span>, xlab<span class="op">=</span><span class="st">""</span>, ylab<span class="op">=</span><span class="st">""</span>, main<span class="op">=</span><span class="fl">1989</span><span class="op">+</span><span class="va">i</span>, breaks<span class="op">=</span><span class="va">Q</span>, col<span class="op">=</span><span class="va">colsR</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="inline-figure"><img src="03-KDE_files/figure-html/plot-KDE-2.png" width="672"></div>
</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="import-the-portuguese-forest-fire-dataset-1.html"><span class="header-section-number">8</span> 4) Import the Portuguese forest fire dataset</a></div>
<div class="next"><a href="conclusions-and-further-analyses-1.html"><span class="header-section-number">10</span> 6) Conclusions and further analyses</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#the-space-time-k-function"><span class="header-section-number">9</span> 5) The space-time K-function</a></li>
<li><a class="nav-link" href="#extract-time-and-pts-object"><span class="header-section-number">9.1</span> 5.1) Extract Time and PTS object</a></li>
<li><a class="nav-link" href="#compute-the-space-time-k-function"><span class="header-section-number">9.2</span> 5.2) Compute the space-time K-function</a></li>
<li>
<a class="nav-link" href="#assess-the-space-time-clustering-behavior"><span class="header-section-number">9.3</span> 5.3) Assess the space-time clustering behavior</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#plot-the-stkhat-outputs"><span class="header-section-number">9.3.1</span> 5.3.1) Plot the stkhat outputs</a></li>
<li><a class="nav-link" href="#run-the-space-time-kernel-density-estimator"><span class="header-section-number">9.3.2</span> 5.3.2) Run the space-time kernel density estimator</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/rstudio/bookdown-demo/blob/master/03-KDE.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/rstudio/bookdown-demo/edit/master/03-KDE.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Advanced Geospatial Data Analysis in R: Environmental Application</strong>" was written by Marj Tonini, Haokun Liu. It was last built on 2023-11-21.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
